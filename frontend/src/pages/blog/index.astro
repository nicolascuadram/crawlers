---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.created_at.valueOf() - a.data.created_at.valueOf(),
);

const formatTitle = (title: string, length: number) => {
	if (title.length > length) {
		return title.substring(0, length) + "...";
	}
	return title;
};
---

<!doctype html>
<html lang="es">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
			<section class="search-filter-bar">
				<input
					type="text"
					class="search-input"
					id="search-input"
					placeholder="Buscar por tÃ­tulo..."
				/>
			</section>
			<section>
				<ul>
					{
						posts.map((post) => (
							<li data-title={post.data.title.toLowerCase()}>
								<a href={`/blog/${post.id}/`}>
									<img
										width={720}
										height={360}
										src={post.data.heroImage}
										alt=""
									/>
									<h4 class="title">
										{formatTitle(post.data.title, 150)}
									</h4>
									<p class="date">
										<FormattedDate
											date={post.data.created_at}
										/>
									</p>
								</a>
							</li>
						))
					}
				</ul>
			</section>
		</main>
		<Footer />
		<script is:inline>
			document.addEventListener("DOMContentLoaded", () => {
				const input = document.getElementById("search-input");
				const items = document.querySelectorAll("ul li");

				input.addEventListener("input", () => {
					const query = input.value.toLowerCase();

					items.forEach((item) => {
						const title = item.getAttribute("data-title") || "";
						const matches = title.includes(query);
						item.style.display = matches ? "" : "none";
					});
				});
			});
		</script>
	</body>
</html>

<style>
	main {
		padding-top: 1em;
		width: 840px;
	}
	.search-filter-bar {
		display: flex;
		justify-content: space-between;
		align-items: center;
		width: 100%;
		margin-bottom: 1em;
	}
	.search-filter-bar .search-input {
		padding: 0.5rem 1rem;
		font-size: 1rem;
		width: 100%;
		max-width: 500px;
		border: 1px solid #ccc;
		border-radius: 12px;
		outline: none;
	}
	.search-filter-bar .search-input:focus {
		border: 1px solid #ba0c2f;
		outline: 1px solid #ba0c2f;
	}
	ul {
		display: flex;
		flex-wrap: wrap;
		gap: 2rem;
		list-style-type: none;
		margin: 0;
		padding: 0;
	}
	ul li {
		width: calc(50% - 1rem);
	}
	ul li * {
		text-decoration: none;
		transition: 0.2s ease;
	}
	ul li:first-child {
		width: 100%;
		margin-bottom: 1rem;
		text-align: center;
		/* padding-right: 10%;
		padding-left: 10%; */
	}
	ul li:first-child img {
		width: 100%;
	}
	ul li:first-child .title {
		font-size: 1.4rem;
	}
	ul li img {
		margin-bottom: 0.5rem;
		border-radius: 12px;
	}
	ul li a {
		display: block;
	}
	.title {
		margin: 0;
		color: rgb(var(--black));
		line-height: 1;
		font-size: 1.3rem;
		text-align: left;
	}
	.date {
		margin: 0;
		color: rgb(var(--gray));
		font-size: 1rem;
		text-align: left;
	}
	ul li a:hover h4,
	ul li a:hover .date {
		color: rgb(var(--accent));
	}
	ul a:hover img {
		box-shadow: var(--box-shadow);
	}
	@media (max-width: 720px) {
		ul {
			gap: 0.5em;
		}
		ul li {
			width: 100%;
			text-align: center;
		}
		ul li:first-child {
			margin-bottom: 0;
			padding-right: 0;
			padding-left: 0;
		}
		ul li:first-child .title {
			font-size: 1.1em;
		}
		ul li:first-child img {
			width: 100%;
		}
		.title {
			font-size: 1.1em;
		}
	}
</style>
